<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录 - CBCOJ</title>
    <link rel="stylesheet" href="/assets/base.css">
    <link rel="stylesheet" href="/assets/components.css">
    <link rel="stylesheet" href="/assets/layout.css">
</head>

<body>
    <nav>
        <div class="nav-left">
            <a href="/" class="logo"><img src="/favicon.ico" width="20" height="20"> CBCOJ </a>
            <a href="/problemlist">题库</a>
            <a href="/discussions">讨论</a>
            <a href="/submissionlist">评测列表</a>
            <a href="/chat">私信</a>
            <a href="/settings">个人设置</a>
        </div>
        <div class="nav-right">
            <div class="login-content">
                <div id="login-area"></div>
                <div id="login-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">正在检测登录状态...</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="page">
        <div class="container">
            <form id="login-form" class="card form-card">
                <label for="username">用户名:</label>
                <input type="text" id="username" name="usrname" required>
                <label for="password">密码:</label>
                <input type="password" id="password" name="paswd" required>
                <button type="submit">登录</button>
            </form>
            <div id="message"></div>
            <hr>
            <a href="register.html" style="display: flex; justify-content: center;">没有账号？点我去注册</a>
        </div>
    </main>

    <script type="text/javascript" src="/assets/checklogin.js"></script>
    <script>
        checkLogin();
        document.getElementById('login-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            try {
                const response = await fetch(BASE_URL + '/api/login?' + new URLSearchParams(formData));
                const result = await response.json();
                if (result[0] === 'Y') {
                    document.getElementById('message').textContent = '登录成功，正在跳转...';
                    document.cookie = `user_cookie=${result[1]}; expires=; path=/;`;
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1000);
                } else {
                    document.getElementById('message').textContent = '登录失败: ' + result[1];
                }
            } catch (error) {
                document.getElementById('message').textContent = '登录请求失败';
                console.error('Error during login request:', error);
            }
        });
    </script>
</body>

</html>